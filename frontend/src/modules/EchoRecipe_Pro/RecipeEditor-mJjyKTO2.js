import{o as Se,g as Te,r as l,f as e}from"./react-D2c-IGkZ.js";import{u as ue,e as we,B as y,L as Ae,S as ze,K as Ie}from"./index-UikHyAVh.js";import{I as G}from"./input-Cn0r6mKL.js";import{d as ce,R as Le,T as Pe,S as me,B as Me,G as Be}from"./textarea-C4ovJ85X.js";import{C,a as k,b as S,d as T}from"./card-BuHw_c-Z.js";import{e as qe}from"./recipe-scaling-GpxSFNwX.js";import{aE as Ue,T as Fe,y as $e}from"./icons-ctH1U6L8.js";import"./charts-SLVNgGXJ.js";import"./radix-CrB2S1eo.js";import"./animations-DTfU6dyf.js";function O({label:f,children:d}){return e.jsxDEV("div",{className:"space-y-1",children:[e.jsxDEV("div",{className:"text-xs font-medium text-muted-foreground",children:f},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:27,columnNumber:7},this),d]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:26,columnNumber:5},this)}const H=[{key:"calories",label:"Calories",unit:"kcal"},{key:"fat",label:"Fat",unit:"g"},{key:"carbs",label:"Carbs",unit:"g"},{key:"protein",label:"Protein",unit:"g"},{key:"fiber",label:"Fiber",unit:"g"},{key:"sugars",label:"Sugars",unit:"g"},{key:"sodium",label:"Sodium",unit:"mg"},{key:"cholesterol",label:"Cholesterol",unit:"mg"}],de=()=>({calories:"",fat:"",carbs:"",protein:"",fiber:"",sugars:"",sodium:"",cholesterol:""}),pe=f=>new Promise((d,h)=>{const c=new FileReader;c.onload=()=>d(String(c.result||"")),c.onerror=()=>h(c.error),c.readAsDataURL(f)}),Ge=new Set(["g","gram","grams","kg","kilogram","kilograms","mg","milligram","milligrams","lb","lbs","pound","pounds","oz","ounce","ounces","ml","l","liter","liters","litre","litres","cl","dl","qt","pt","cup","cups","tbsp","tablespoon","tablespoons","tbs","tsp","teaspoon","teaspoons","gal","gallon","gallons","each","ea","dozen","stick","sticks","sheet","sheets","piece","pieces","clove","cloves","can","cans","bag","bags","sprig","sprigs","bunch","bunches","head","heads","slice","slices","pinch","pinches","dash","dashes"].map(f=>f.toLowerCase())),Oe=f=>f.toLowerCase().replace(/[^a-z%]/g,""),Qe=f=>{const d=Oe(f);return d?!!(Ge.has(d)||/^[a-z]{1,3}$/.test(d)||/^[a-z]+%$/.test(d)):!1},We=f=>{const d=f.trim();if(!d)return{item:"",prep:""};const h=d.match(/^(.*?)[\s]*\(([^)]*)\)\s*$/);if(h)return{item:h[1].trim().replace(/,\s*$/,""),prep:h[2].trim()};const[c,...p]=d.split(",");return p.length===0?{item:d,prep:""}:{item:c.trim(),prep:p.join(",").trim()}};function ri(){const{id:f}=Se(),d=Te(),{getRecipeById:h,updateRecipe:c}=ue(),{toast:p}=we(),t=l.useMemo(()=>f?h(f):void 0,[f,h]),w=l.useCallback(()=>{if(typeof window<"u"&&window.history.length>1){d(-1);return}d("/?tab=search")},[d]),[v,B]=l.useState(""),[A,D]=l.useState(""),[E,r]=l.useState([]),[o,n]=l.useState(""),[u,a]=l.useState(""),[b,z]=l.useState(""),[R,q]=l.useState([]),[I,Y]=l.useState(de),[j,_]=l.useState(void 0),[Ne,K]=l.useState(!1),[J,fe]=l.useState([]),[X,be]=l.useState([]),[Z,ge]=l.useState([]),[ee,xe]=l.useState([]),[ie,he]=l.useState([]),[te,Ee]=l.useState([]),[se,ve]=l.useState({...ce}),[He,Ye]=l.useState(!0),ae=l.useRef(null),le=l.useRef(null);l.useEffect(()=>{if(!t)return;const i=t.extra??{},s=i.serverNotes;B(t.title??"");const m=Array.isArray(i.allergenList)?i.allergenList.map(String):Array.isArray(s?.allergens)?s.allergens.map(String):typeof i.allergens=="string"?i.allergens.split(",").map(N=>N.trim()).filter(Boolean):[];r(m),m.length?D(m.join(", ")):D(String(i.allergens??""));const x=String(i.cookTime??s?.cookTime??t.cookTime??""),V=String(i.cookTemp??s?.cookTemp??"");n(x),a(V);const U=String(i.directions??s?.directions??(t.instructions??[]).join(`
`)??"").split(/\r?\n/).map(N=>N.trim()).filter(Boolean),Q=U.filter(N=>N.startsWith("IMG:")),W=U.filter(N=>!N.startsWith("IMG:"));z(W.join(`
`)),q(Q.map(N=>N.slice(4)).filter(N=>typeof N=="string"&&N.length>0));const ne=i.nutrition??t.nutrition??null,oe=de();if(ne)for(const{key:N}of H){const $=ne[N];$!=null&&(oe[N]=String($))}Y(oe);const P=i.classification??{},F=s?.modifiers??{},M=N=>Array.isArray(N)?N.map(String):typeof N=="string"?N.split(",").map($=>$.trim()).filter(Boolean):[];fe(M(P.nationality??F.nationality)),be(M(P.courses??F.courses)),ge(M(P.recipeType??F.recipeType)),xe(M(P.prepMethod??F.prepMethod)),he(M(P.equipment??F.equipment)),Ee(M(P.recipeAccess??s?.access));const ke=i.taxonomy??void 0;ve({...ce,...ke??{}}),_(t.imageDataUrls?.[0]??t.image??void 0)},[t]);const re=E,Re=l.useCallback(i=>{D(i);const s=i.split(",").map(m=>m.trim()).filter(Boolean);r(s)},[]);l.useCallback(i=>{r(i),D(i.join(", "))},[]);const De=l.useCallback(async i=>{if(!i?.length)return;const s=Array.from(i);try{const m=await Promise.all(s.map(x=>pe(x)));q(x=>[...x,...m])}catch(m){console.error("Failed to read direction images",m)}},[]),je=l.useCallback(async i=>{if(i?.length)try{const s=await pe(i[0]);_(s)}catch(s){console.error("Failed to read cover image",s)}},[]),Ve=l.useCallback(()=>{if(!t)return;const s=[...b.split(/\r?\n/).map(g=>g.trim()).filter(Boolean),...R.map(g=>`IMG:${g}`)].join(`
`),m=H.map(({key:g})=>{const Q=(I[g]??"").trim();if(!Q)return null;const W=Number(Q);return Number.isFinite(W)?[g,W]:null}).filter(g=>Array.isArray(g)),x=m.length?Object.fromEntries(m):null,V=(t.extra??{}).classification??{};try{c(t.id,{title:v.trim()||"Untitled",instructions:s?s.split(/\r?\n/):void 0,nutrition:x,imageDataUrls:j?[j,...(t.imageDataUrls??[]).slice(1)]:t.imageDataUrls,image:j??t.image,extra:{...t.extra??{},allergens:A,allergenList:E,cookTime:o,cookTemp:u,directions:s,directionImages:R,nutrition:x??void 0,taxonomy:se,classification:{...V,nationality:J,courses:X,recipeType:Z,prepMethod:ee,equipment:ie,recipeAccess:te}}}),p({title:"Recipe finalized",description:"Saved to your library and cleared for the next entry."}),d("/?tab=search")}catch(g){console.error("Failed to finalize recipe",g);const U=g instanceof Error&&g.message.trim().length?g.message:"Unable to save changes.";p({title:"Finalize failed",description:U,variant:"destructive"})}},[t,b,R,I,v,j,A,E,o,u,J,X,Z,ee,ie,te,se,c,p,d]),L=l.useMemo(()=>{const s=(t?.extra??{}).modifiers;return Array.isArray(s)?s.map(m=>String(m)).map(m=>m.trim()).filter(m=>m.length>0):[]},[t]),ye=l.useCallback(()=>{if(!t)return;const i=window.prompt("Modifier name");if(!i)return;const s=i.trim();if(!s)return;const m=Array.from(new Set([...L,s]));c(t.id,{extra:{...t.extra??{},modifiers:m}})},[L,t,c]),Ce=l.useCallback(i=>{if(!t)return;const s=L.filter((m,x)=>x!==i);c(t.id,{extra:{...t.extra??{},modifiers:s}})},[L,t,c]);return t?e.jsxDEV("div",{className:"min-h-screen text-foreground",style:{paddingLeft:"calc(var(--sidebar-offset, 116px) + 0.5rem)"},children:[e.jsxDEV(Ae,{},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:522,columnNumber:7},this),e.jsxDEV("div",{className:"container mx-auto space-y-6 py-4",children:[e.jsxDEV("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxDEV("div",{children:[e.jsxDEV("h1",{className:"text-2xl font-semibold",children:"Edit Recipe"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:526,columnNumber:13},this),e.jsxDEV("p",{className:"text-sm text-muted-foreground",children:"Update presentation details, directions, and nutrition for this recipe."},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:527,columnNumber:13},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:525,columnNumber:11},this),e.jsxDEV("div",{className:"flex gap-2",children:[e.jsxDEV(y,{variant:"secondary",onClick:w,children:"Back"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:532,columnNumber:13},this),e.jsxDEV(y,{onClick:Ve,children:"Finalize & Clear"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:535,columnNumber:13},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:531,columnNumber:11},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:524,columnNumber:9},this),e.jsxDEV("div",{className:"grid gap-6 lg:grid-cols-[2fr_1fr]",children:[e.jsxDEV("div",{className:"space-y-6",children:[e.jsxDEV(C,{children:[e.jsxDEV(k,{className:"pb-4",children:e.jsxDEV(S,{className:"text-base",children:"General Details"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:543,columnNumber:17},this)},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:542,columnNumber:15},this),e.jsxDEV(T,{className:"space-y-4",children:e.jsxDEV("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxDEV(O,{label:"Recipe Name",children:e.jsxDEV(G,{value:v,onChange:i=>B(i.target.value),placeholder:"House Burger",suggestionScope:"recipes",minSuggestionQueryLength:1},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:548,columnNumber:21},this)},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:547,columnNumber:19},this),e.jsxDEV(O,{label:"Allergens",children:e.jsxDEV(G,{value:A,onChange:i=>Re(i.target.value),placeholder:"Gluten, Dairy",suggestionScope:"tags",minSuggestionQueryLength:1},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:557,columnNumber:21},this)},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:556,columnNumber:19},this),e.jsxDEV(O,{label:"Cook Time",children:e.jsxDEV(G,{value:o,onChange:i=>n(i.target.value),placeholder:"2:30"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:566,columnNumber:21},this)},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:565,columnNumber:19},this),e.jsxDEV(O,{label:"Cook Temp",children:e.jsxDEV(G,{value:u,onChange:i=>a(i.target.value),placeholder:"350F"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:569,columnNumber:21},this)},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:568,columnNumber:19},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:546,columnNumber:17},this)},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:545,columnNumber:15},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:541,columnNumber:13},this),e.jsxDEV(C,{children:[e.jsxDEV(k,{className:"pb-4",children:e.jsxDEV(S,{className:"text-base",children:"Ingredients"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:577,columnNumber:17},this)},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:576,columnNumber:15},this),e.jsxDEV(T,{className:"space-y-4",children:[t.extra&&typeof t.extra=="object"&&"ingredientsTable"in t.extra&&Array.isArray(t.extra.ingredientsTable)&&e.jsxDEV(Le,{ingredients:t.extra.ingredientsTable,recipeTitle:t.title,servings:1,compact:!0},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:581,columnNumber:19},this),e.jsxDEV(_e,{recipeId:t.id},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:588,columnNumber:17},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:579,columnNumber:15},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:575,columnNumber:13},this),e.jsxDEV(C,{children:[e.jsxDEV(k,{className:"flex flex-col gap-2 pb-4",children:[e.jsxDEV("div",{className:"flex w-full items-center justify-between gap-3",children:[e.jsxDEV(S,{className:"text-base",children:"Directions"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:595,columnNumber:19},this),e.jsxDEV("div",{className:"flex items-center gap-2",children:[e.jsxDEV("input",{ref:ae,type:"file",accept:"image/*",multiple:!0,hidden:!0,onChange:i=>{De(i.target.files),i.target&&(i.target.value="")}},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:597,columnNumber:21},this),e.jsxDEV(y,{type:"button",variant:"outline",size:"sm",className:"flex items-center gap-2",onClick:()=>ae.current?.click(),children:[e.jsxDEV(Ue,{className:"h-4 w-4"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:615,columnNumber:23},this)," Add photos"]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:608,columnNumber:21},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:596,columnNumber:19},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:594,columnNumber:17},this),e.jsxDEV("p",{className:"text-xs text-muted-foreground",children:"Write step-by-step directions. Photos attach below and will display at the end of the instructions."},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:619,columnNumber:17},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:593,columnNumber:15},this),e.jsxDEV(T,{className:"space-y-4",children:[e.jsxDEV(Pe,{value:b,onChange:i=>z(i.target.value),rows:8,placeholder:`1. Preheat oven to 350F
2. Toast buns and prep toppings`,className:"min-h-[180px]"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:624,columnNumber:17},this),R.length>0&&e.jsxDEV("div",{className:"space-y-3",children:[e.jsxDEV(me,{},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:633,columnNumber:21},this),e.jsxDEV("div",{className:"grid gap-3 sm:grid-cols-2 xl:grid-cols-3",children:R.map((i,s)=>e.jsxDEV("div",{className:"group relative overflow-hidden rounded-lg border bg-muted/30",children:[e.jsxDEV("img",{src:i,alt:`Step visual ${s+1}`,className:"h-40 w-full object-cover"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:637,columnNumber:27},this),e.jsxDEV("button",{type:"button",onClick:()=>q(m=>m.filter((x,V)=>V!==s)),className:"absolute right-2 top-2 rounded-full bg-background/80 p-1 text-muted-foreground shadow hover:text-destructive","aria-label":"Remove step photo",children:e.jsxDEV(Fe,{className:"h-4 w-4"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:646,columnNumber:29},this)},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:638,columnNumber:27},this)]},`${i.slice(0,32)}-${s}`,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:636,columnNumber:25},this))},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:634,columnNumber:21},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:632,columnNumber:19},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:623,columnNumber:15},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:592,columnNumber:13},this),e.jsxDEV(C,{children:[e.jsxDEV(k,{className:"pb-4",children:[e.jsxDEV(S,{className:"text-base",children:"Nutrition"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:658,columnNumber:17},this),e.jsxDEV("p",{className:"text-xs text-muted-foreground",children:"Enter available nutrition facts. Leave fields blank if values are unknown."},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:659,columnNumber:17},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:657,columnNumber:15},this),e.jsxDEV(T,{children:e.jsxDEV("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:H.map(({key:i,label:s,unit:m})=>e.jsxDEV(O,{label:`${s} (${m})`,children:e.jsxDEV(G,{inputMode:"decimal",value:I[i],onChange:x=>Y(V=>({...V,[i]:x.target.value})),placeholder:"0"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:667,columnNumber:23},this)},i,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:666,columnNumber:21},this))},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:664,columnNumber:17},this)},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:663,columnNumber:15},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:656,columnNumber:13},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:540,columnNumber:11},this),e.jsxDEV("aside",{className:"space-y-4",children:[e.jsxDEV(C,{children:[e.jsxDEV(k,{className:"pb-3",children:e.jsxDEV(S,{className:"text-base",children:"Cover Photo"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:688,columnNumber:17},this)},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:687,columnNumber:15},this),e.jsxDEV(T,{className:"space-y-4",children:[e.jsxDEV("div",{className:"overflow-hidden rounded-lg border bg-muted/20",children:j?e.jsxDEV("img",{src:j,alt:t.title,className:"h-56 w-full object-cover"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:693,columnNumber:21},this):e.jsxDEV("div",{className:"flex h-56 w-full items-center justify-center text-sm text-muted-foreground",children:"No cover image yet"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:695,columnNumber:21},this)},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:691,columnNumber:17},this),e.jsxDEV("input",{ref:le,type:"file",accept:"image/*",hidden:!0,onChange:i=>{je(i.target.files),i.target&&(i.target.value="")}},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:700,columnNumber:17},this),e.jsxDEV("div",{className:"flex gap-2",children:[e.jsxDEV(y,{type:"button",variant:"outline",className:"flex-1",onClick:()=>le.current?.click(),children:j?"Replace Photo":"Upload Photo"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:711,columnNumber:19},this),e.jsxDEV(y,{type:"button",variant:"outline",className:"flex-1",onClick:()=>K(!0),children:"From Gallery"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:719,columnNumber:19},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:710,columnNumber:17},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:690,columnNumber:15},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:686,columnNumber:13},this),e.jsxDEV(C,{children:[e.jsxDEV(k,{className:"pb-3",children:e.jsxDEV(S,{className:"text-base",children:"Service Snapshot"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:733,columnNumber:17},this)},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:732,columnNumber:15},this),e.jsxDEV(T,{className:"space-y-4 text-sm",children:[e.jsxDEV("div",{children:[e.jsxDEV("div",{className:"text-xs uppercase text-muted-foreground",children:"Allergens"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:737,columnNumber:19},this),e.jsxDEV("div",{className:"mt-2 flex flex-wrap gap-2",children:re.length?re.map(i=>e.jsxDEV(Me,{variant:"secondary",children:i},i,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:741,columnNumber:25},this)):e.jsxDEV("span",{className:"text-muted-foreground",children:"None listed"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:746,columnNumber:23},this)},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:738,columnNumber:19},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:736,columnNumber:17},this),e.jsxDEV(me,{},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:750,columnNumber:17},this),e.jsxDEV("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxDEV("div",{children:[e.jsxDEV("div",{className:"text-xs uppercase text-muted-foreground",children:"Cook Time"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:753,columnNumber:21},this),e.jsxDEV("div",{className:"font-medium",children:o||"—"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:754,columnNumber:21},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:752,columnNumber:19},this),e.jsxDEV("div",{children:[e.jsxDEV("div",{className:"text-xs uppercase text-muted-foreground",children:"Cook Temp"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:757,columnNumber:21},this),e.jsxDEV("div",{className:"font-medium",children:u||"—"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:758,columnNumber:21},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:756,columnNumber:19},this),e.jsxDEV("div",{className:"col-span-2",children:[e.jsxDEV("div",{className:"text-xs uppercase text-muted-foreground",children:"Directions Photos"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:761,columnNumber:21},this),e.jsxDEV("div",{className:"font-medium",children:R.length},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:762,columnNumber:21},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:760,columnNumber:19},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:751,columnNumber:17},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:735,columnNumber:15},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:731,columnNumber:13},this),e.jsxDEV(C,{children:[e.jsxDEV(k,{className:"pb-3",children:e.jsxDEV(S,{className:"text-base",children:"Modifiers"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:770,columnNumber:17},this)},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:769,columnNumber:15},this),e.jsxDEV(T,{className:"space-y-3 text-sm",children:[e.jsxDEV("p",{className:"text-xs text-muted-foreground",children:"Add optional modifiers for service teams to reference variations or add-ons."},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:773,columnNumber:17},this),L.length?e.jsxDEV("ul",{className:"space-y-2",children:L.map((i,s)=>e.jsxDEV("li",{className:"flex items-center justify-between rounded-md border border-dashed border-border/60 bg-muted/20 px-3 py-2",children:[e.jsxDEV("span",{className:"font-medium text-foreground",children:i},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:783,columnNumber:25},this),e.jsxDEV("button",{type:"button",onClick:()=>Ce(s),className:"text-xs font-medium text-muted-foreground transition hover:text-destructive",children:"Remove"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:784,columnNumber:25},this)]},`${i}-${s}`,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:779,columnNumber:23},this))},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:777,columnNumber:19},this):e.jsxDEV("div",{className:"rounded-md border border-dashed border-border/60 bg-muted/10 px-3 py-2 text-muted-foreground",children:"No modifiers yet."},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:795,columnNumber:19},this),e.jsxDEV(y,{type:"button",variant:"outline",size:"sm",className:"w-full justify-start gap-2",onClick:ye,children:[e.jsxDEV($e,{className:"h-4 w-4"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:806,columnNumber:19},this)," Add Modifier"]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:799,columnNumber:17},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:772,columnNumber:15},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:768,columnNumber:13},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:685,columnNumber:11},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:539,columnNumber:9},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:523,columnNumber:7},this),e.jsxDEV(ze,{},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:813,columnNumber:7},this),e.jsxDEV(Ie,{},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:814,columnNumber:7},this),e.jsxDEV(Be,{open:Ne,onOpenChange:K,onSelectImage:_},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:815,columnNumber:7},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:516,columnNumber:5},this):e.jsxDEV("div",{className:"p-6",children:[e.jsxDEV("div",{className:"mb-4 text-sm text-muted-foreground",children:"Recipe not found."},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:504,columnNumber:9},this),e.jsxDEV("div",{className:"flex items-center gap-2",children:[e.jsxDEV(y,{onClick:w,children:"Back"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:506,columnNumber:11},this),e.jsxDEV("a",{href:"/",className:"text-sm underline",children:"Home"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:507,columnNumber:11},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:505,columnNumber:9},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:503,columnNumber:7},this)}function _e({recipeId:f}){const{getRecipeById:d,updateRecipe:h}=ue(),c=d(f),p=r=>typeof r=="string"?r:r==null?"":String(r),t=()=>({qty:"",unit:"",item:"",prep:"",yield:"",cost:"",subId:""}),w=l.useMemo(()=>Array.isArray(c.ingredients)?c.ingredients.map(r=>String(r??"")):[],[c.ingredients]),v=l.useMemo(()=>{const o=(c.extra??{})?.serverNotes;return(Array.isArray(o?.ingredients)?o.ingredients:[]).map(u=>({...t(),qty:p(u.qty),unit:p(u.unit),item:p(u.item),prep:p(u.prep),yield:p(u.yield),cost:p(u.cost),subId:p(u.subId)}))},[c.extra]),B=l.useCallback(r=>{const o=t(),n=r.trim();if(!n)return o;const u=qe(n);let a=n;u&&(o.qty=u.raw.trim(),a=u.remainder.trim());const b=a.split(/\s+/).filter(Boolean);if(b.length){const I=b[0];Qe(I)&&(o.unit=I,b.shift())}const z=b.join(" ").trim(),{item:R,prep:q}=We(z);return o.item=R,o.prep=q,o},[]),A=l.useMemo(()=>{const r=c.extra?.ingredientsTable;let o;Array.isArray(r)&&r.length>0?o=r.map(a=>({...t(),...a})):v.length>0?o=v.map(a=>({...t(),...a})):o=w.map(a=>B(a));const n=o.map(a=>({...t(),...a})),u=Math.max(n.length,w.length,v.length,12);for(;n.length<u;)n.push(t());return n},[w,B,v,c.extra]),D=r=>!r.qty.trim()&&!r.unit.trim()&&!r.item.trim()&&!r.prep.trim()&&!r.yield.trim()&&!r.cost.trim(),E=(r,o)=>{if(!c)return;const n=A.map((a,b)=>b===r?{...a,...o}:a).map(a=>({qty:p(a.qty).trim(),unit:p(a.unit).trim(),item:p(a.item).trim(),prep:p(a.prep).trim(),yield:p(a.yield).trim(),cost:p(a.cost).trim(),subId:p(a.subId).trim()}));for(;n.length&&D(n[n.length-1]);)n.pop();const u=n.filter(a=>!D(a)).map(a=>{const b=[a.qty,a.unit,a.item].filter(z=>z.length>0).join(" ").trim();return a.prep.length>0?b.length>0?`${b}, ${a.prep}`:a.prep:b}).filter(a=>a.length>0);h(f,{ingredients:u.length?u:c.ingredients,extra:{...c.extra??{},ingredientsTable:n}})};return e.jsxDEV("div",{className:"w-full overflow-auto rounded-lg border",children:e.jsxDEV("table",{className:"w-full text-sm",children:[e.jsxDEV("thead",{className:"bg-muted",children:e.jsxDEV("tr",{className:"text-left",children:[e.jsxDEV("th",{className:"p-2",children:"QTY"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:973,columnNumber:13},this),e.jsxDEV("th",{className:"p-2",children:"UNIT"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:974,columnNumber:13},this),e.jsxDEV("th",{className:"p-2",children:"ITEM"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:975,columnNumber:13},this),e.jsxDEV("th",{className:"p-2",children:"PREP"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:976,columnNumber:13},this),e.jsxDEV("th",{className:"p-2",children:"YIELD %"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:977,columnNumber:13},this),e.jsxDEV("th",{className:"p-2",children:"COST"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:978,columnNumber:13},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:972,columnNumber:11},this)},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:971,columnNumber:9},this),e.jsxDEV("tbody",{children:A.map((r,o)=>e.jsxDEV("tr",{className:"border-t",children:[e.jsxDEV("td",{className:"p-1",children:e.jsxDEV("input",{value:r.qty,onChange:n=>E(o,{qty:n.target.value}),className:"w-20 rounded border bg-background px-2 py-1","data-fuzzy":"off"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:985,columnNumber:17},this)},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:984,columnNumber:15},this),e.jsxDEV("td",{className:"p-1",children:e.jsxDEV("input",{value:r.unit,onChange:n=>E(o,{unit:n.target.value}),className:"w-24 rounded border bg-background px-2 py-1","data-fuzzy-scope":"tags","data-fuzzy-min":"1"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:993,columnNumber:17},this)},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:992,columnNumber:15},this),e.jsxDEV("td",{className:"p-1",children:e.jsxDEV("input",{value:r.item,onChange:n=>E(o,{item:n.target.value}),className:"w-full rounded border bg-background px-2 py-1","data-fuzzy-scope":"ingredients","data-fuzzy-min":"1"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:1002,columnNumber:17},this)},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:1001,columnNumber:15},this),e.jsxDEV("td",{className:"p-1",children:e.jsxDEV("input",{value:r.prep,onChange:n=>E(o,{prep:n.target.value}),className:"w-32 rounded border bg-background px-2 py-1","data-fuzzy-scope":"ingredients","data-fuzzy-min":"1"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:1011,columnNumber:17},this)},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:1010,columnNumber:15},this),e.jsxDEV("td",{className:"p-1",children:e.jsxDEV("input",{value:r.yield,onChange:n=>E(o,{yield:n.target.value}),className:"w-24 rounded border bg-background px-2 py-1","data-fuzzy":"off"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:1020,columnNumber:17},this)},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:1019,columnNumber:15},this),e.jsxDEV("td",{className:"p-1",children:e.jsxDEV("input",{value:r.cost,onChange:n=>E(o,{cost:n.target.value}),className:"w-24 rounded border bg-background px-2 py-1","data-fuzzy":"off"},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:1028,columnNumber:17},this)},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:1027,columnNumber:15},this)]},`ingredient-row-${o}`,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:983,columnNumber:13},this))},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:981,columnNumber:9},this)]},void 0,!0,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:970,columnNumber:7},this)},void 0,!1,{fileName:"/app/code/client/pages/RecipeEditor.tsx",lineNumber:969,columnNumber:5},this)}export{ri as default};
