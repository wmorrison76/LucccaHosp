import{useEffect,useRef,useState}from"react";export function useVisualSync({bpm=120,fps=60}={}){const r=useRef(0);const[phase,setPhase]=useState(0);const[time,setTime]=useState(0);const[tick,setTick]=useState(0);useEffect(()=>{let last=performance.now();const beatMs=60000/Math.max(1,bpm);const frameMs=1000/Math.max(1,fps);function loop(now){const dt=now-last;if(dt>=frameMs-1){last=now;const t=time+dt;setTime(t);const ph=(t%beatMs)/beatMs;setPhase(ph);if(ph<0.02)setTick(x=>x+1)}r.current=requestAnimationFrame(loop)}r.current=requestAnimationFrame(loop);return()=>cancelAnimationFrame(r.current)},[bpm,fps]);return{phase,time,tick}}
export default useVisualSync;
